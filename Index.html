<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Investment Recommendation</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body { background: #f8f9fa; }
    .container { max-width: 800px; margin-top: 30px; background: white; padding: 30px; border-radius: 10px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
    h2, h3 { text-align: center; margin-bottom: 20px; }
    .form-label { margin-top: 10px; }
    canvas { max-width: 100% !important; }
    table { margin-top: 20px; }
    .btn { margin-right: 10px; }
    .logo {
      width: 150px;
      margin-bottom: 10px;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
  </style>
</head>
<body>

<div class="container" id="content">
  <img src="logo.jpeg" alt="Curate My Money Logo" class="logo">

  <h2>Investment Recommendation Form</h2>


  <div class="row g-3">
    <div class="col-md-6">
      <label class="form-label">Client Name</label>
      <input type="text" id="clientName" class="form-control">
    </div>
    <div class="col-md-3">
      <label class="form-label">Age</label>
      <input type="number" id="age" class="form-control">
    </div>
    <div class="col-md-3">
      <label class="form-label">PAN</label>
      <input type="text" id="pan" class="form-control">
    </div>
    <div class="col-md-6">
      <label class="form-label">City</label>
      <input type="text" id="city" class="form-control">
    </div>
    <div class="col-md-6">
      <label class="form-label">Objective</label>
      <input type="text" id="objective" class="form-control">
    </div>
    <div class="col-md-6">
      <label class="form-label">Investment Duration (years)</label>
      <input type="number" id="invDuration" class="form-control">
    </div>
    <div class="col-md-6">
      <label class="form-label">Risk Profile</label>
      <span class="ms-2"><a href="#" data-bs-toggle="modal" data-bs-target="#questionnaireModal" style="font-size: 0.9em;">(Don't know? Click here)</a></span>
      <select id="riskProfile" class="form-select">
        <option value="" disabled selected>Select your risk profile</option>
        <option>Conservative</option>
        <option>Conservative to Moderate</option>
        <option>Moderate</option>
        <option>Moderate to Aggressive</option>
        <option>Aggressive</option>
      </select>
      <div id="riskProfileResult" class="mt-2"></div>
    </div>
    <div class="col-md-6">
      <label class="form-label">Investment Type</label>
      <select id="invType" class="form-select">
        <option value="" disabled selected>Select investment type</option>
        <option>SIP</option>
        <option>Lumpsum</option>
      </select>
    </div>
    <div class="col-md-6">
      <label class="form-label">Investment Amount</label>
      <input type="number" id="amount" class="form-control">
    </div>
    <div class="col-md-6">
      <label class="form-label">Assumed Rate of Return (%)</label>
      <input type="number" id="rateOfReturn" class="form-control">
    </div>
  </div>

  <div class="text-center mt-4">
    <button onclick="calculateRecommendation()" class="btn btn-primary">Generate Recommendation</button>
    <button onclick="downloadPDF()" class="btn btn-outline-secondary">Download as PDF</button>
  </div>

  <h3>Asset Allocation</h3>
  <div class="d-flex justify-content-center">
    <canvas id="pieChart" width="300" height="300"></canvas>
  </div>

  <h3>Recommended Funds</h3>
  <div class="table-responsive">
    <table class="table table-striped">
      <thead class="table-light">
        <tr><th>Scheme Name</th><th>Allocation %</th><th>Category</th></tr>
      </thead>
      <tbody id="fundTable"></tbody>
    </table>
  </div>
</div>

<!-- Modal -->
<div class="modal fade" id="questionnaireModal" tabindex="-1" aria-labelledby="questionnaireModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="questionnaireModalLabel">Investor Questionnaire</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <form id="questionnaireForm">
          <div class="mb-3">
            <label class="form-label">1. Investment Goal Horizon – When will you need most of this money?</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="1" id="q1a"><label class="form-check-label" for="q1a">A. &lt; 3 Yrs</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="2" id="q1b"><label class="form-check-label" for="q1b">B. 3-5 Yrs</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="3" id="q1c"><label class="form-check-label" for="q1c">C. 5-7 Yrs</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="4" id="q1d"><label class="form-check-label" for="q1d">D. 7-10 Yrs</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q1" value="5" id="q1e"><label class="form-check-label" for="q1e">E. &gt;10 Yrs</label></div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">2. Emergency Fund – How many months of living expenses are liquid and easily accessible?</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="1" id="q2a"><label class="form-check-label" for="q2a">A. None</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="2" id="q2b"><label class="form-check-label" for="q2b">B. 1-3 mo</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="3" id="q2c"><label class="form-check-label" for="q2c">C. 3-6 mo</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="4" id="q2d"><label class="form-check-label" for="q2d">D. 6-12 mo</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q2" value="5" id="q2e"><label class="form-check-label" for="q2e">E. &gt;12 mo</label></div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">3. Primary Investment Objective</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="1" id="q3a"><label class="form-check-label" for="q3a">A. Capital Protection</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="2" id="q3b"><label class="form-check-label" for="q3b">B. Income with minimal growth</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="3" id="q3c"><label class="form-check-label" for="q3c">C. Balanced growth & income</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="4" id="q3d"><label class="form-check-label" for="q3d">D. Growth with some income</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q3" value="5" id="q3e"><label class="form-check-label" for="q3e">E. Aggressive growth</label></div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">4. Market Downturn Reaction – If your portfolio fell 15 % in a month, you would…</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="1" id="q4a"><label class="form-check-label" for="q4a">A. Sell everything</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="2" id="q4b"><label class="form-check-label" for="q4b">B. Sell part and move to safety</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="3" id="q4c"><label class="form-check-label" for="q4c">C. Stay invested</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="4" id="q4d"><label class="form-check-label" for="q4d">D. Buy a little more</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q4" value="5" id="q4e"><label class="form-check-label" for="q4e">E. Invest aggressively</label></div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">5. Knowledge & Experience – How familiar are you with equity and bond markets?</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="1" id="q5a"><label class="form-check-label" for="q5a">A. None</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="2" id="q5b"><label class="form-check-label" for="q5b">B. Basic</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="3" id="q5c"><label class="form-check-label" for="q5c">C. Moderate</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="4" id="q5d"><label class="form-check-label" for="q5d">D. Experienced</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q5" value="5" id="q5e"><label class="form-check-label" for="q5e">E. Professional/Expert</label></div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">6. Income Stability</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q6" value="1" id="q6a"><label class="form-check-label" for="q6a">A. Very uncertain</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q6" value="2" id="q6b"><label class="form-check-label" for="q6b">B. Somewhat uncertain</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q6" value="3" id="q6c"><label class="form-check-label" for="q6c">C. Stable salary/income</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q6" value="4" id="q6d"><label class="form-check-label" for="q6d">D. Stable + Incentive</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q6" value="5" id="q6e"><label class="form-check-label" for="q6e">E. Highly stable + surplus</label></div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">7. Dependants & Obligations</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q7" value="1" id="q7a"><label class="form-check-label" for="q7a">A. Many dependants, High EMIs</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q7" value="2" id="q7b"><label class="form-check-label" for="q7b">B. Many dependants, Low EMIs</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q7" value="3" id="q7c"><label class="form-check-label" for="q7c">C. Few dependants, moderate EMIs</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q7" value="4" id="q7d"><label class="form-check-label" for="q7d">D. Few dependants, low EMIs</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q7" value="5" id="q7e"><label class="form-check-label" for="q7e">E. No dependants, no EMIs</label></div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">8. Comfort With Volatility – Annual return swing you can tolerate?</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q8" value="1" id="q8a"><label class="form-check-label" for="q8a">A. ± 5 %</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q8" value="2" id="q8b"><label class="form-check-label" for="q8b">B. ± 10 %</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q8" value="3" id="q8c"><label class="form-check-label" for="q8c">C. ± 15 %</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q8" value="4" id="q8d"><label class="form-check-label" for="q8d">D. ± 20 %</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q8" value="5" id="q8e"><label class="form-check-label" for="q8e">E. ± 25 %</label></div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">9. Past Investing Behaviour – In previous corrections you…</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q9" value="1" id="q9a"><label class="form-check-label" for="q9a">A. Always exited</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q9" value="2" id="q9b"><label class="form-check-label" for="q9b">B. Often exited</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q9" value="3" id="q9c"><label class="form-check-label" for="q9c">C. Held on</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q9" value="4" id="q9d"><label class="form-check-label" for="q9d">D. Added a bit</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q9" value="5" id="q9e"><label class="form-check-label" for="q9e">E. Added a lot</label></div>
            </div>
          </div>
          <div class="mb-3">
            <label class="form-label">10. Return Expectation (10 yr CAGR)</label>
            <div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q10" value="1" id="q10a"><label class="form-check-label" for="q10a">A. ≤ 5 %</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q10" value="2" id="q10b"><label class="form-check-label" for="q10b">B. 6-8%</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q10" value="3" id="q10c"><label class="form-check-label" for="q10c">C. 9-11%</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q10" value="4" id="q10d"><label class="form-check-label" for="q10d">D. 12-14%</label></div>
              <div class="form-check"><input class="form-check-input" type="radio" name="q10" value="5" id="q10e"><label class="form-check-label" for="q10e">E. ≥ 15 %</label></div>
            </div>
          </div>
          <div class="text-end">
            <button type="button" class="btn btn-primary" onclick="submitQuestionnaire()">Submit</button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
function calculateRecommendation() {
  const type = document.getElementById("invType").value;
  const amount = parseFloat(document.getElementById("amount").value);
  const duration = parseInt(document.getElementById("invDuration").value);
  const rate = parseFloat(document.getElementById("rateOfReturn").value) / 100;

  let sip = 0, lumpsum = 0;
  if (type === "SIP") {
    sip = (amount * (((Math.pow(1 + rate / 12, 12 * duration)) - 1) * (1 + rate / 12)) / (rate / 12)).toFixed(2);
    alert("Future Value (SIP): ₹" + sip);
  } else {
    lumpsum = (amount * Math.pow((1 + rate), duration)).toFixed(2);
    alert("Future Value (Lumpsum): ₹" + lumpsum);
  }

  const equity = 60, debt = 30, hybrid = 10;
  const data = [equity, debt, hybrid];
  const ctx = document.getElementById("pieChart").getContext("2d");
  new Chart(ctx, {
    type: 'pie',
    data: {
      labels: ['Equity', 'Debt', 'Hybrid'],
      datasets: [{ data: data, backgroundColor: ['#36A2EB', '#FFCE56', '#FF6384'] }]
    },
    options: { responsive: true, plugins: { legend: { position: 'bottom' } } }
  });

  const fundTable = document.getElementById("fundTable");
  fundTable.innerHTML = "";
  const sampleFunds = [
    { name: "ABC Equity Fund", percent: "40", category: "Equity" },
    { name: "XYZ Debt Fund", percent: "30", category: "Debt" },
    { name: "LMN Hybrid Fund", percent: "30", category: "Hybrid" },
  ];
  sampleFunds.forEach(fund => {
    const row = `<tr><td>${fund.name}</td><td>${fund.percent}</td><td>${fund.category}</td></tr>`;
    fundTable.innerHTML += row;
  });
}

function downloadPDF() {

  const original = document.getElementById("content");

  // Clone content to work with
  const clone = original.cloneNode(true);

  // Replace canvas with image inside the clone
  const canvas = original.querySelector("#pieChart");
  if (canvas) {
    const imgData = canvas.toDataURL("image/png");
    const img = document.createElement("img");
    img.src = imgData;
    img.style.maxWidth = "100%";
    const cloneCanvas = clone.querySelector("#pieChart");
    cloneCanvas.replaceWith(img);
  }

  // Create a temporary container to hold the clone
  const tempDiv = document.createElement("div");
  tempDiv.style.position = "fixed";
  tempDiv.style.top = "-9999px";
  tempDiv.appendChild(clone);
  document.body.appendChild(tempDiv);

  setTimeout(() => {
    html2pdf().set({
      margin: 0.5,
      filename: 'Investment_Recommendation.pdf',
      image: { type: 'jpeg', quality: 0.98 },
      html2canvas: { scale: 2 },
      jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' }
    }).from(clone).save().then(() => {
      document.body.removeChild(tempDiv); // clean up
    });
  }, 100);

}
function submitQuestionnaire() {
  const form = document.getElementById("questionnaireForm");
  const answers = form.querySelectorAll("input[type='radio']:checked");

  // Calculate total score by summing values of checked radio buttons
  let score = 0;
  answers.forEach(input => {
    score += parseInt(input.value);
  });

  // Determine risk profile based on score
  let profile = "";
  if (score >= 10 && score <= 17) profile = "Conservative";
  else if (score >= 18 && score <= 25) profile = "Conservative to Moderate";
  else if (score >= 26 && score <= 34) profile = "Moderate";
  else if (score >= 35 && score <= 42) profile = "Moderate to Aggressive";
  else if (score >= 43 && score <= 50) profile = "Aggressive";

  // Set dropdown value and display result message
  document.getElementById("riskProfile").value = profile;
  const resultContainer = document.getElementById("riskProfileResult");
  resultContainer.innerHTML = `
    <div class="alert alert-info alert-dismissible fade show" role="alert">
      Your assessed risk profile is: <strong>${profile}</strong> (Score: ${score})
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>`;

  bootstrap.Modal.getInstance(document.getElementById("questionnaireModal")).hide();
}</script>

</body>
</html>